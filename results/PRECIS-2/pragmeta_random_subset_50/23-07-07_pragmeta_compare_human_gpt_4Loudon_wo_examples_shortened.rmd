---
title: "PragMeta PRECIS-2 Scoring: Comparison Human vs ChatGPT (Loudon  briefing)"
author: "Tim Woelfle"
date: "2023-07-07"
output: 
  flexdashboard::flex_dashboard:
    source_code: "https://github.com/timwoelfle/PragMeta-GPT-Analysis/blob/main/results/23-07-07_pragmeta_compare_human_gpt.rmd"
    mathjax: NULL
    self_contained: TRUE
---

```{css}
table {
  margin: auto;
  border-top: 1px solid #666;
  border-bottom: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }

/* Hack to make prompt-tab scrollable again */
#chatgpt-prompt .chart-stage {
  overflow: scroll;
}
```

```{r, warning=FALSE}
library(ggplot2)
library(patchwork)
library(psych)

domains = c("eligibility", "recruitment", "setting", "organization", "flexibility_delivery", "flexibility_adherence", "followup", "primary_outcome", "primary_analysis")

pragmeta = read.csv2("../data/pragmeta_random_subset_50.csv")
rownames(pragmeta) = pragmeta$trials.trials_id

results = read.csv("23-07-07_results_Loudon.csv", row.names = 1)

### SSE
results_na_3 = results
results_na_3[is.na(results_na_3)] = 3
results$sse = rowSums(abs(results_na_3[,paste0(domains, "_human")]-results_na_3[,paste0(domains, "_gpt")])**2)
results[,6:23] = lapply(results[,6:23], function(x) factor(x, levels=c(1,2,3,4,5,NA)))
results = results[order(results$sse),]

### Cohen's kappa
factorize = function(x) factor(x, levels=c(1,2,3,4,5,NA))
weight_matrix = matrix(c(0,1,4,9,16,4, 1,0,1,4,9,4, 4,1,0,1,4,4, 9,4,1,0,1,4, 16,9,4,1,0,4, 4,4,4,4,4,0), nrow=6)
# Weight matrix: (NA vs any score is weighted 4)
#      [,1] [,2] [,3] [,4] [,5] [,NA]
# [1,]    0    1    4    9   16    4
# [2,]    1    0    1    4    9    4
# [3,]    4    1    0    1    4    4
# [4,]    9    4    1    0    1    4
# [5,]   16    9    4    1    0    4
# [NA,]   4    4    4    4    4    0
for (i in seq_len(nrow(results))) {
  results[i, "cohen_kappa_w"] = cohen.kappa(table(factorize(unlist(results[i, paste0(domains, "_human")])), factorize(unlist(results[i, paste0(domains, "_gpt")])), useNA="always"), w=weight_matrix)$weighted.kappa
}
```

Column {data-width=60}
-------------------------------------

### Score comparisons of 40 random PragMeta publications

```{r, results="asis"}
cat("#### Individual publications: Cohen's Kappa\n\n")
cat("* Mean Kappa: ", round(mean(results$cohen_kappa_w),2), " (SD ", round(sd(results$cohen_kappa_w),2), ")\n\n", sep="")
cat("* Median Kappa: ", round(median(results$cohen_kappa_w),2), " (IQR ", round(quantile(results$cohen_kappa_w,0.25),2), "-", round(quantile(results$cohen_kappa_w,0.75),2), ", range ", min(results$cohen_kappa_w), "-", max(results$cohen_kappa_w), ")\n\n", sep="")
cat("#### Individual publications: Sum of squared errors (SSE)\n\n")
cat("For ICC and SSE calculation, NA is imputed as 3 (compare [Loudon 2017](https://doi.org/10.1016/j.jclinepi.2017.06.001) for ICC). SSE = sum((human-gpt)²). Examples: error of 1 in each of the 9 domains: SSE = 9×(1²)= 9; error of 4 in 1 domain: 1×(4²)=16; error of 2 in 5 domains: SSE = 5×(2²) = 20\n\n")
cat("* Mean SSE: ", round(mean(results$sse),2), " (SD ", round(sd(results$sse),2), ")\n\n", sep="")
cat("* Median SSE: ", round(median(results$sse),2), " (IQR ", round(quantile(results$sse,0.25),2), "-", round(quantile(results$sse,0.75),2), ", range ", min(results$sse), "-", max(results$sse), ")\n\n", sep="")
cat("* Modules: ", paste(names(table(pragmeta[rownames(results), "trials.module"])), table(pragmeta[rownames(results), "trials.module"]), sep=": ", collapse=", "), "\n\n", sep="")
cat("All 40 publications sorted by SSE (best at the top, worst at the bottom):\n\n")
cat("-------------------------------------\n\n")

for (ind in rownames(results)) {
  cat("#### <a href='#", ind, "' title='Jump to ChatGPT response on the right'>", pragmeta[ind, "trials.title"], "</a> (", pragmeta[ind, "trials.pub_year"], "), ", pragmeta[ind, "trials.module"], ", SEE: ", results[ind, "sse"], ", Cohen Kappa: ", round(results[ind, "cohen_kappa_w"], 2), "\n\n", sep="")
  
  cat(knitr::kable(data.frame(
    eligibility = c(results[ind, "eligibility_human"], results[ind, "eligibility_gpt"]),
    recruitment = c(results[ind, "recruitment_human"], results[ind, "recruitment_gpt"]),
    setting = c(results[ind, "setting_human"], results[ind, "setting_gpt"]),
    organization = c(results[ind, "organization_human"], results[ind, "organization_gpt"]),
    delivery = c(results[ind, "flexibility_delivery_human"], results[ind, "flexibility_delivery_gpt"]),
    adherence = c(results[ind, "flexibility_adherence_human"], results[ind, "flexibility_adherence_gpt"]),
    followup = c(results[ind, "followup_human"], results[ind, "followup_gpt"]),
    outcome = c(results[ind, "primary_outcome_human"], results[ind, "primary_outcome_gpt"]),
    analysis = c(results[ind, "primary_analysis_human"], results[ind, "primary_analysis_gpt"]),
    row.names = c("Human", "ChatGPT")
  ), format="html", padding=1, border=1), "\n\n")
  cat("-------------------------------------\n\n")
}
```

### Score heatmaps

```{r, fig.width=18, fig.height=10}
plot_metrics_overview = function(results, domains, x_rater, y_rater) {
  plot_heatmap = function(data, title, limit_max) {
    ggplot(
      data, 
      aes(x, y)
    ) +
      geom_tile(aes(fill=Freq)) + xlab(x_rater) + ylab(y_rater) +
      geom_abline(slope=1, linewidth=0.3, color="lightgrey") +
      geom_text(aes(label=ifelse(Freq==0,"",Freq))) +
      scale_fill_gradient(low="white", high="red", limits=c(0, limit_max)) +
      ggtitle(title) +
      theme_bw() +
      theme(legend.position="none")
  }
  
  all_domains_table = table(x=factorize(unlist(results[,paste0(domains, "_", x_rater)])), y=factorize(unlist(results[,paste0(domains, "_", y_rater)])), useNA="always")

  all_domains_cohen_kappa_w = cohen.kappa(all_domains_table, w=weight_matrix)$weighted.kappa
  all_domains_heatmap = plot_heatmap(as.data.frame(all_domains_table), paste0("all domains (weighted Cohen κ=", round(all_domains_cohen_kappa_w, 2), ")"), 125)
  
  domain_tables = list()
  domain_cohen_kappa_w = list()
  domain_icc = list()
  domain_heatmaps = list()
  for (domain in domains) {
    domain_tables[[domain]] = table(x=factorize(results[,paste0(domain, "_", x_rater)]), y=factorize(results[,paste0(domain, "_", y_rater)]), useNA="always")
    domain_cohen_kappa_w[[domain]] = cohen.kappa(domain_tables[[domain]], w=weight_matrix)$weighted.kappa
    #ICC(results_na_3[,c(paste0(domains[1], "_", "Rater1"), paste0(domains[1], "_", "Rater2"))])
    domain_icc[[domain]] = ICC(results_na_3[,c(paste0(domain, "_", x_rater), paste0(domain, "_", y_rater))])$results["Average_random_raters", "ICC"]
    domain_heatmaps[[domain]] = plot_heatmap(as.data.frame(domain_tables[[domain]]), paste0(domain, " (κ=", round(domain_cohen_kappa_w[[domain]],2), ", ICC=", round(domain_icc[[domain]],2), ")"), 32)
  }
  
  x_rater_hist = ggplot(as.data.frame(table(unlist(results[,paste0(domains, "_", x_rater)]), useNA = "always")), aes(x=Var1, y=Freq)) +
    geom_bar(stat="identity") + theme_bw() + xlab(NULL) + ggtitle(x_rater) + ylim(c(0,170))
  y_rater_hist = ggplot(as.data.frame(table(unlist(results[,paste0(domains, "_", y_rater)]), useNA = "always")), aes(x=Var1, y=Freq)) +
    geom_bar(stat="identity") + theme_bw() + xlab(NULL) + ggtitle(y_rater) + ylim(c(0,170))
  
  wrap_plots(
    wrap_plots(
      x_rater_hist, 
      wrap_plots(all_domains_heatmap, qplot(unlist(domain_cohen_kappa_w), unlist(domain_icc), xlab="Weighted Cohen kappa", ylab="ICC(2,k)", xlim=c(-0.2,1), ylim=c(0,1), size=I(3)) + theme_bw(), ncol=2),
      y_rater_hist, 
      nrow=3
    ),
    wrap_plots(domain_heatmaps, ncol=3, nrow=3),
    ncol=2,
    widths=c(0.4,0.6)
  )
}

plot_metrics_overview(results, domains, "human", "gpt")
```

Column {data-width=40 .tabset}
-------------------------------------

### ChatGPT responses per publication

```{r, results='asis'}
for (ind in rownames(results)) {
  cat("<a name='", ind, "'></a>\n\n", sep="")
  cat("#### <a href='https://doi.org/", pragmeta[ind, "trials.doi"], "' title='Open publication'>", pragmeta[ind, "trials.title"], "</a> (", pragmeta[ind, "trials.pub_year"], "), ", pragmeta[ind, "trials.module"], "\n\n", sep="")
  cat(gsub("\n", "\n\n", results[ind, "gpt_message"]), "\n\n", sep="")
}
```

### ChatGPT prompt

* Model: `gpt-3.5-turbo-16k-0613`
* Temperature: `0`
* Briefing derived from: [Loudon 2017](https://doi.org/10.1016/j.jclinepi.2017.06.001)

#### System prompt

```
You are an expert in clinical trial design and are tasked to assess the PRECIS-2 scores of a trial based on the full text of its publication. You have the following briefing:
---
# The nine domains of PRECIS-2

## 1. Eligibility criteria: Who is selected to participate in the trial?

A highly pragmatic approach to eligibility criteria would be to include in the trial anyone with the condition of interest who is likely to be a candidate for the intervention if it was being provided in usual care for this condition. So, if in usual care the intervention would likely be used for children, elderly people, people with a range of comorbidities, and people with a probable diagnosis rather than, say, a laboratory confirmed diagnosis, then all of these groups should be in the trial too. If people aged over 80 or with multiple morbidities would not receive the intervention in usual care because we already know that this intervention does more harm than good in elderly or multi-morbid patients, then a pragmatic design choice would be to exclude them from the trial. A trial with eligibility design choices like this would score at or close to 5 on the PRECIS-2 scale.

As the level of similarity between the people in the trial and those in usual care decreases, then so would the PRECIS-2 score. Many things could reduce the score, but some examples include

* Excluding people not known or shown to be highly adherent to the intervention.
* Excluding people using tests or measures that are not used or available in usual care.
* Excluding people not expected to be highly responsive to the intervention.
* Excluding people who would be likely to receive the intervention in usual care but inclusion in the trial is considered too difficult because of challenges unrelated to the delivery of the intervention. Children, people over the age of 65, and pregnant women are good examples of people commonly excluded because of anticipated difficulties of gaining ethical approval rather than whether they would be likely to receive an intervention in usual care.
* Excluding people whose adherence and follow-up may pose difficulties, whether because of social disadvantage, personal circumstances, or illness (such as homelessness, substance misuse, mental health problems, or poor motivation).
* Excluding people dependent on help for activities of daily living, unless they would usually not be eligible for intervention.

Finally, exclusion criteria for known safety issues would not generally reduce the PRECIS-2 score since such individuals would not be expected to get the intervention in usual care.

## 2. Recruitment: How are participants recruited into the trial?

This domain has been included to encourage trialists to consider how and where they will recruit people to their trial.

The most extreme pragmatic approach to recruitment would be to do this in usual care so that only the people who attend a clinic with the condition of interest are recruited after they present on their own behalf without any overt recruitment effort. A highly pragmatic approach to trial design would also recruit from more than one clinic as an explicit way of increasing applicability of the trial results. Recruiting through usual appointments at a diverse range of clinics is likely to score at or close to 5 on the PRECIS-2 scale.

If the above is not feasible, at least as the sole recruitment route, trialists will need to add other recruitment strategies. If extra resources will be required to recruit people to the trial, trialists need to consider if this affects applicability, especially if participants are recruited from settings other than the one in which the results are likely to be applied. For example, recruiting in secondary care for an intervention that will mainly be used in primary care will ensure that the recruited patients are different in severity and treatment than the patients with this same condition in primary care; and so this will make the trial more explanatory and reduce the PRECIS 2 score. Additional recruitment approaches that could potentially reduce the PRECIS-2 score include

* Searching medical record systems for eligible participants and then mailing invitation letters. Depending on local resources, such as electronic medical records and comprehensive local disease registers, this approach may be easily achievable in usual care and so would not reduce the PRECIS-2 score.
* Media advertising campaigns such as television and radio advertisements, newspaper advertisements, flyers, websites, press releases, letters to the editor, interviews with the chief investigator on television or radio. The issue to consider here is whether these campaigns are being used simply to speed up recruitment, or because they are the only way to reach a dispersed population. In the latter case, if such campaigns would not be available in usual care then this trial recruitment route is more explanatory.
* Incentives such as cash payment, vouchers, travel costs, or childcare. Some of these incentives may be better considered as part of the intervention (for example, a lifestyle change intervention aimed at new mothers may only be effective because childcare was also provided and women could therefore attend sessions).

## 3. Setting: Where is the trial being done?

This domain has been included to encourage trialists to explicitly consider the match between the setting of their trial and the setting where their results are likely to be applied. While there are no accepted guidelines for how to assess the impact of setting on applicability, there are several characteristics of the setting that will almost always need to be considered, including geography, healthcare system, country, and the socioeconomic and ethnic mix of the population. All of these might affect the applicability of results from a particular trial.

The most extremely pragmatic approach to setting would be to do the trial in an identical setting to which you intend the results to be applied. Such a trial is likely to score at or close to 5 on PRECIS-2.

Even settings that seem rather restrictive could still be a highly pragmatic design choice if this setting is the usual care setting where patients are treated for the particular health condition. For example, if a trial was carried out in the most specialist intensive care units in the country and the intention of the trial was to support decision making in these highly specialised units, then the design choice with regard to setting is still pragmatic. Conversely, if the trial results were intended to be useful for all intensive care units, but the trial included only highly specialised units, then the trial is now taking a more explanatory approach to the choice of setting that goes against the intention of the trial.

Approaches to setting that are likely to reduce the PRECIS-2 score include

* Selecting participating centres from among only specialist or academic centres when the trial is intended to be applicable to all types of practice or clinic treating the condition of interest.
* Running the trial in a single centre. It is rare that a trial is done with the intention that its results should apply to only that single centre. Including several centres makes it easier to claim that the trial setting matches that to which the results will be applied.

## 4. Organisation: What expertise and resources are needed to deliver the intervention?

This domain has been included to encourage trialists to consider the match between how care is organised and delivered in the trial and how the intervention would be made available to patients in usual care. As there have been acknowledged difficulties in implementing results post-trial (even in settings where the trial was conducted), we wanted trialists to consider organising the delivery of their trial intervention with an awareness of how easy it would be to implement the intervention post-trial .

A highly pragmatic design would aim to slot the intervention into the usual organisation of care for the condition of interest, making use of no more than the existing healthcare staff and resources in that setting. A design like this is likely to score at or close to 5 on PRECIS-2.

Sometimes a change to how care is organised is itself the intervention being evaluated, and the difference between the trial and usual care is clear. In this case the organisation domain would be explanatory compared with current usual care, but trialists can note that the difference is an explicit feature of the intervention.

The PRECIS-2 organisation score will be reduced to the degree trialists make changes in how care is delivered compared with the usual recipients and care delivery. For example, the trial team may, in the intervention arm, provide additional training to staff or provide additional staff so that the intervention can be delivered. Patients who would normally be seen in primary care may be seen by specialists in secondary care instead, or they may receive additional expensive diagnostic procedures unavailable in usual care. The success or otherwise of the trial then depends on resources unavailable in usual care, reducing applicability. If these additional resources are essential to the effectiveness of the intervention they should be considered to be part of the intervention and be specified in the part of the protocol describing the intervention. In that case these resources should not be counted when this element of the trial is judged.

Organisational approaches that are likely to reduce the PRECIS-2 score include the following (but only when they are not incorporated and described as necessary elements of the intervention):

* Increasing the number of healthcare or other professionals available to deliver the intervention over and above the levels available in usual care.
* Providing significant levels of additional training to increase the expertise of healthcare professionals.
* Requiring healthcare professionals to have some minimum level of experience, defined by length of time, in working with the intervention that is greater than would be the case in usual care.
* Requiring healthcare professionals to have a specialty certification that would not be considered essential to deliver the intervention in usual care.
* Increasing the resources (such as facilities, diagnostic equipment, consumables) available to deliver the intervention, measure outcomes, or do follow-up over and above what would be available in usual care.

## 5. Flexibility (delivery): How should the intervention be delivered?

In PRECIS-2, trialists wishing to conduct more pragmatic trials are encouraged to think about how the intervention will be implemented post-trial in the setting where the results are expected to be applied. The most pragmatic design approach to delivery flexibility would leave the details of how to implement the intervention up to providers, in other words, what happens in usual care. Thus, the methodology of how to deliver an intervention is not rigidly prescriptive in the protocol. For example, the details of how to perform a surgical procedure could be left entirely to the surgeon, or how to deliver an educational programme is left to the discretion of the educator. Additionally, a pragmatic approach would not dictate which other interventions were permitted, or how to deliver them, which again is the situation in usual practice. This sort of delivery flexibility would score at or close to 5 on PRECIS-2. Flexibility (delivery) applies to all intervention arms and the comparator (control) arm if usual care is not the comparator, and if necessary each of these arms will need to be scored separately. If usual care is the intended comparator but any elements relating to delivery are changed it ceases to be usual care and needs to be scored.

As delivery flexibility is reduced, the trial moves towards a more explanatory approach in this domain. Approaches to delivery flexibility that are likely to reduce the PRECIS-2 score include

* A highly specified, protocol driven intervention. For example, specific direction is given for how to the administer the intervention (such as dose, dosing schedule, surgical procedures, educational material, and delivery)
* Having measures in place to monitor the compliance of those delivering the intervention (such as doctors) with the protocol and measures (up to and including exclusion) to address poor compliance.
* The timing of intervention delivery is tightly defined and designed to maximise the intervention effect.
* Providers undertake additional interventions that would not occur in usual care
* Restrictions are placed on the number and types of co-interventions, particularly if excluded co-interventions would dilute any intervention effect
* There is specific direction for applying permitted co-interventions
* There are specific directions for managing complications or side effects of the intervention.

## 6. Flexibility (adherence): What measures are in place to ensure participants adhere to the intervention?

It is important that trialists focused on applicability consider how probable it is that there will be uptake of the intervention being tested and how recipients will engage with it in the setting in which it will be later applied. A highly pragmatic design approach would allow for full flexibility in how end user recipients engage with the intervention. In usual care, health professionals encourage patients to take medication or follow therapy as best they can, and such encouragement would not count against a pragmatic design; if it also happens in usual care, allowing it in the trial is a pragmatic design decision. A trial with no special measures to enforce engagement or compliance would score at or close to 5 on PRECIS-2. On the other hand, a trial protocol that lays out methods to monitor and ensure patient compliance would score at or close to 1 on PRECIS-2. Flexibility (adherence) applies to all intervention arms and the comparator (control) arm if usual care if not the comparator, and if necessary each of these arms will need to be scored separately. If usual care is the intended comparator but any elements relating to adherence are changed it ceases to be usual care and needs to be scored.

It is possible that improving recipients’ ability to take medication or follow therapy is the intervention under evaluation, a situation similar to that already described for the Setting and Organisation domains. In this case, the Flexibility (adherence) domain would be explanatory compared with current usual care, but trialists can note that the difference is an explicit feature of the intervention.

As flexibility for recipients is reduced, the trial moves towards a more explanatory approach on this domain. Approaches to recipient flexibility that are likely to reduce the PRECIS-2 score include

* Having a trial pre-screening stage where patients are evaluated for adherence with the intervention (such as dose, dosing schedule, attendance at therapy sessions). Patients judged to not be adherent are excluded.
* Withdrawing patients from the trial if their adherence with the intervention drops below some specified level. For example, a trial might withdraw patients if they failed to attend two consecutive sessions of cognitive behavioural therapy or failed to take more than 90% of their medication.
* Having measures in place to monitor patient adherence with the protocol and measures (up to and including withdrawal) to address poor adherence. Measures to increase patient adherence should this fall below some specified level could, for example, include scheduling an extra discussion with a research nurse about why following the trial instructions is important.

## 7. Follow-up: How closely are participants followed up?

This domain encourages trialists to think about follow-up with regard to the setting where the results will be applied. The most pragmatic position with regard to follow-up would be to have no more follow-up of recipients than would be the case in usual care. Indeed, the most extreme position is to have no follow-up contact at all with recipients and to obtain outcome data by other means (such as electronic medical records or other usual data to measure mortality or hospital admissions). Trials that have no more follow-up than is normal in usual care and have minimal additional data collection (or use data obtained from administrative or clinical record systems without direct contact with the participant) would be likely to score at or close to 5 on PRECIS-2.

As follow-up becomes more intense, the trial becomes more explanatory and the PRECIS-2 score will decrease. Follow-up approaches that are likely to reduce the PRECIS-2 score include

* Follow-up visits that are more frequent than would typically occur under usual care.
* Unscheduled follow-up visits are triggered by a primary outcome event.
* Unscheduled follow-up visits are triggered by an intervening event that is likely to lead to the primary outcome event.
* Patients are contacted if they fail to keep trial appointments. This would not reduce the PRECIS-2 score if this was also done in usual care.
* More extensive data are collected, particularly intervention related data, than would be typical outside the trial
* Visits are longer than usual care and involve additional or different staff.

Often the required trial outcomes may be obtained only through contact with the recipients. Even in the “no follow-up” approach, assessment of outcomes may be achieved with a single follow-up at the end of the study. The end of study would need to be defined so that there is sufficient time for the desired study outcomes (see Primary outcome domain below) to be observed. When the follow-up is done in this way, it is unlikely to have an impact on engagement or response to the treatment, and so such a follow-up approach would be viewed as pragmatic and rated at or close to 5.

It is often the case that explanatory trials are interested in the effect of an intervention only during a brief intervention period or shortly after. On the other hand, trials taking a pragmatic approach to design may follow recipients well beyond the intervention period. This longer period of follow-up may require more contacts than would be the case in usual care, but this need not be inconsistent with a pragmatic approach if it does not result in care management that differs from the usual conditions. It is, however, important to consider the burden of follow-up for participants.

## 8. Primary outcome: How relevant is it to participants?

The choice of primary outcome is a crucial trial design decision, and a pragmatic approach would be to select an outcome that is of obvious importance from the patient’s perspective. Post-trial, an outcome selected using a pragmatic approach would also be relevant to commissioners of care, the people who decide whether to implement the intervention on the basis of its results. For example, an intervention that aims to reduce falls in elderly people living independently in the community should have as its primary outcome the number of falls in the elderly living independently in the community. This outcome has meaning to patients, their relatives and friends, healthcare professionals, and policymakers. Measures of, say, bone density, muscle strength, or functional ability are distant from the key question of whether the intervention prevents elderly people falling in their own homes. Trials that choose outcomes of obvious importance to patients, and measure them in a way that is the same or similar to the way they are measured in usual care would be likely to score at or close to 5 on PRECIS-2.

As the primary outcome becomes less recognisably important to patients, or is assessed on criteria seldom used in usual care, the trial becomes more explanatory and the PRECIS-2 score will decrease. Approaches to the primary outcomes that are likely to reduce the PRECIS-2 score include

* Choosing a surrogate outcome (such as blood test) that the intervention is expected to have a direct effect on, or the use of safety climate surveys rather than medical error events or near miss events.
* Using a composite primary outcome in which some of the elements are less important to patients or participants than others (such as incidence of death, stroke, myocardial infarction, or renal dysfunction at 30 days).
* Having central adjudication of the outcome or using an assessment that needs special training or tests not normally used in usual care.
* Choosing an outcome that is important but mainly to providers, typically because it is a physiological outcome considered useful in treatment planning and monitoring.
* Measuring an outcome that is important but at a time that is earlier than would be normal in usual care. For example, stroke could be a primary outcome in trials making explanatory or pragmatic design choices. However, time horizons may vary from short term after a one-time intervention (more explanatory) to long term (more pragmatic).

## 9. Primary analysis: To what extent are all data included?

Most trials are a superiority design so the most pragmatic approach with regard to the analysis would be to make no special allowance in the analysis for non-adherence, practice variability, etc. In other words, the pragmatic approach to the analysis would typically be an intention-to-treat analysis using all available data. This sort of analysis would score at or close to 5 on PRECIS-2. (Non-inferiority and equivalence trials are usually contrary to intention-to-treat analysis.)

The intention-to-treat analysis has recently also become the norm for superiority trials taking a more explanatory design approach, especially when regulatory approval for an intervention is being sought. The most explanatory approach would be to use the “as treated analysis” as the primary analysis, in which only those patients who actually received (or did not receive) the intervention would be analysed in the intervention and control groups respectively, irrespective of their initial randomised group allocation.

Other causes of missing data may be important but may not affect how pragmatic or explanatory a trial is. Systematic exclusion of data from participants because, say, they were poorly adherent would make a trial more explanatory. Using all data but doing nothing to try and fill gaps caused by missing data would not in itself make trial more pragmatic or explanatory; missing data, especially if there is a lot of it, makes any conclusions more uncertain regardless of the design approach taken.

Approaches to the primary analysis that are likely to reduce the PRECIS-2 score include

* Excluding non-compliant recipients (per protocol analysis)
* Analyse recipients to treatment received instead of treatment randomised (as treated analysis)
* Excluding data from non-adherent providers
* Excluding data from trial sites or providers who recruit below expected volume.

For some trials taking an explanatory approach (dose finding trials are an example), it may be appropriate to have primary analysis restricted in the ways mentioned; otherwise such restricted analyses of the primary outcome could be pre-planned as secondary analyses of the primary outcome.
---
```

#### User prompt

```
This is the full text to be assessed:
---
%FULLTEXT%
---

For each of the 9 domains of PRECIS-2, perform the following steps:
1. Extract 1-3 relevant quotes from the full text.
2. Explain your reasoning in 1 paragraph.
3. Give a score X from 1 (very explanatory) to 5 (very pragmatic) in square brackets like this: "Score: [X]". If the full text does not contain enough information to assess a specific domain, report "Score: [NA]".

Do not provide a final summary paragraph in the end.
```
